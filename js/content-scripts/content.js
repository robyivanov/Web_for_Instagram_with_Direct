const INIT_CLASS="mtz-inst-dwn-init"+chrome.runtime.id.slice(0,5),imgOptions={isElementHovered:!1,url:null,isVideo:!1,linkToVideo:null};class Content{constructor(){const b=document.documentElement.classList.contains("mtz_mobile_mode");b&&"/tv/upload/"!==location.pathname&&(this.storage=STORAGE,this.headSelector=".b5itu",this.leftHeadSelector=".mXkkY.HOQT4",this.rightHeadSelector=".mXkkY.KDuQp",this.initHandlers(),this.initStorage(),this.initListeners(),this.renderBtns(),setInterval(()=>this.renderBtns(),100),setInterval(()=>this.search(),1e3),this.appendSpriteStyles())}initListeners(){chrome.storage.onChanged.addListener(a=>{a.darkTheme?this.changeTheme(a.darkTheme.newValue):a.zoomMode?this.changeZoomMode(a.zoomMode.newValue):a.imgFormat?this.storage.imgFormat=a.imgFormat.newValue:a.isPinned&&(this.storage.isPinned=a.isPinned.newValue)}),chrome.runtime.onMessage.addListener(b=>{if(b&&"object"==typeof b&&"string"==typeof b.action)switch(b.action){case"updateUnreadCount":default:}})}initHandlers(){const b=$(document.body);b.on("click",".mtz-icon-back",()=>history.back()),b.on("click",".mtz-icon-forward",()=>history.forward()),b.on("click",".mtz-icon-refresh",()=>location.reload()),b.on("click",".mtz-icon-direct",()=>location.href=chrome.extension.getURL("direct.html")),b.on("click",".mtz-icon-tv",()=>this.openTvPopup()),b.on("click",".mtz-icon-moon",()=>this.changeTheme()),b.on("click",".mtz-icon-screen",()=>this.takeScreenshot())}initStorage(){chrome.storage.local.get(this.storage,b=>{0===Object.keys(b).length?this.storage=STORAGE:(this.storage=b,this.applyTheme(),this.checkZoomMode())})}renderBtns(){const a=$(this.headSelector);a.find(".coreSpriteNavBack").remove(),a.find(".mXkkY").length?(this.$refreshTpl(this.leftHeadSelector,a),this.$backTpl(this.leftHeadSelector,a),this.$tvTpl(this.rightHeadSelector,a),this.$screenTpl(this.rightHeadSelector,a,"append")):(this.$refreshTpl(this.headSelector,a),this.$backTpl(this.headSelector,a),this.$tvTpl(this.headSelector,a,"append"),this.$screenTpl(this.headSelector,a,"append"))}$refreshTpl(d,a,b="prepend"){a.find(".mtz-icon-refresh").length||(b="append"==b?"appendTo":"prependTo",$(`<button class="mtz-icon mtz-icon-refresh"></button>`)[b](d))}$forwardTpl(d,a,b="prepend"){a.find(".mtz-icon-forward").length||(b="append"==b?"appendTo":"prependTo",$(`<button class="mtz-icon mtz-icon-forward"></button>`)[b](d))}$backTpl(d,a,b="prepend"){a.find(".mtz-icon-back").length||(b="append"==b?"appendTo":"prependTo",$(`<button class="mtz-icon mtz-icon-back"></button>`)[b](d))}$tvTpl(d,a,b="prepend"){a.find(".mtz-icon-tv").length||(b="append"==b?"appendTo":"prependTo",$(`<button class="mtz-icon mtz-icon-tv"></button>`)[b](d))}$moonTpl(d,a,b="prepend"){a.find(".mtz-icon-moon").length||(b="append"==b?"appendTo":"prependTo",$(`<button class="mtz-icon mtz-icon-moon"></button>`)[b](d))}$screenTpl(d,a,b="prepend"){a.find(".mtz-icon-screen").length||(b="append"==b?"appendTo":"prependTo",$(`<button class="mtz-icon mtz-icon-screen"></button>`)[b](d))}applyTheme(){const a=this.storage.darkTheme?"add":"remove";document.documentElement.classList[a]("mtz_dark_mode")}saveStorage(){chrome.storage.local.set(this.storage)}openTvPopup(){open("https://www.instagram.com/tv/upload/","","toolbar=0, status=0, width=800, height=600")}changeTheme(){this.storage.darkTheme=!this.storage.darkTheme,this.saveStorage(),this.applyTheme()}takeScreenshot(){chrome.runtime.sendMessage({action:"takeScreenshot",imgFormat:this.storage.imgFormat},function(){})}search(){$("img.FFVAD").not("."+INIT_CLASS).each((e,a)=>{const b=$(a),c=this.getImgUrl(b);b.siblings(".mtz-inst-dwn").length||b.addClass(INIT_CLASS)}),$("article video").not("."+INIT_CLASS).each((e,a)=>{const b=$(a),c=b.attr("src")||b[0].currentSrc;b.siblings(".mtz-inst-dwn").length||b.addClass(INIT_CLASS)}),$("section._9eogI._01nki video").not("."+INIT_CLASS).each((f,a)=>{const b=$(a),c=b.attr("src")||b[0].currentSrc,d=$("section.xIOBI.xcV9j");d.find(".mtz-inst-dwn").length||b.addClass(INIT_CLASS)}),$("section._9eogI._01nki img.y-yJ5").not("."+INIT_CLASS).each((f,a)=>{const b=$(a),c=this.getImgUrl(b),d=$("section.xIOBI.xcV9j");d.find(".mtz-inst-dwn").length||b.addClass(INIT_CLASS)})}getImgUrl(c){const a=c.attr("srcset");return a?a.split(",").pop().replace(/ \w+/g,""):null}appendSpriteStyles(){$(`            <style>                html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteApp_Icon, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteCamera__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteChevron_left__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteChevron_right__outline__24__grey_5, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteCircle_add__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteComment__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteDelete__outline__24__grey_0, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteDirect__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteFacebook__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteHashtag__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteHeart__filled__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteHeart__filled__24__red_5, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteHeart__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteHome__filled__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteHome__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteLink__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteLocation__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteMail__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteMobile_nav_type_logo, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteMore_horizontal__filled__24__grey_0, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteMore_horizontal__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteNew_post__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpritePaging_chevron, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpritePhoto_grid__outline__24__blue_5, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpritePhoto_grid__outline__24__grey_5, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpritePhoto_list__outline__24__blue_5, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpritePhoto_list__outline__24__grey_5, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteSave__filled__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteSave__outline__24__blue_5, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteSave__outline__24__grey_5, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteSave__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteSearch__filled__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteSearch__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteSettings__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteShare__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteShare_facebook, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteShare_messenger, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteShare_twitter, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteShare_whatsapp, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteTag_up__outline__24__blue_5, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteTag_up__outline__24__grey_5, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteUser__filled__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteUser__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteUser_follow__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteVerified_small, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteX__outline__24__grey_9 {                    background-image: url(https://ig-web.net/app/img/4c9eeb.png?v=${Date.now()}); }                @media not all, (-webkit-min-device-pixel-ratio: 1.5), (min-resolution: 144dpi) {                    html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteApp_Icon, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteCamera__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteChevron_left__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteChevron_right__outline__24__grey_5, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteCircle_add__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteComment__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteDelete__outline__24__grey_0, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteDirect__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteFacebook__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteHashtag__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteHeart__filled__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteHeart__filled__24__red_5, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteHeart__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteHome__filled__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteHome__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteLink__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteLocation__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteMail__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteMobile_nav_type_logo, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteMore_horizontal__filled__24__grey_0, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteMore_horizontal__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteNew_post__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpritePaging_chevron, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpritePhoto_grid__outline__24__blue_5, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpritePhoto_grid__outline__24__grey_5, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpritePhoto_list__outline__24__blue_5, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpritePhoto_list__outline__24__grey_5, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteSave__filled__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteSave__outline__24__blue_5, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteSave__outline__24__grey_5, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteSave__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteSearch__filled__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteSearch__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteSettings__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteShare__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteShare_facebook, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteShare_messenger, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteShare_twitter, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteShare_whatsapp, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteTag_up__outline__24__blue_5, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteTag_up__outline__24__grey_5, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteUser__filled__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteUser__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteUser_follow__outline__24__grey_9, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteVerified_small, html.mtz_mobile_mode.mtz_dark_mode .glyphsSpriteX__outline__24__grey_9 {                        background-image: url(https://ig-web.net/app/img/4c9eeb-mac.png?v=${Date.now()}); } }            </style>        `).appendTo(document.body)}changeZoomMode(a){this.storage.zoomMode=a,this.checkZoomMode()}checkZoomMode(){this.storage.zoomMode?($(document).on("keydown",this.zoomHandler),this.insertMouseListeners()):($(document).off("keydown",this.zoomHandler),document.removeEventListener("mouseenter",this.mouseenterHandler))}zoomHandler(a){if(90===a.keyCode&&imgOptions.isElementHovered&&!imgOptions.isVideo)try{chrome.runtime.sendMessage({action:"getImg",url:imgOptions.url})}catch(a){}else if(90===a.keyCode&&imgOptions.isElementHovered&&imgOptions.isVideo)try{chrome.runtime.sendMessage({action:"getVideo",url:imgOptions.linkToVideo})}catch(a){}}insertMouseListeners(){$(document).on("mouseenter","._si7dy, .FFVAD, .KL4Bh, ._9AhH0, .eLAPa _23QFA",this.mouseEnterHandler),$(document).on("mouseleave","._si7dy, .FFVAD, .KL4Bh, ._9AhH0, .eLAPa _23QFA",this.mouseLeaveHandler)}removeMouseListeners(){$(document).off("mouseenter","._si7dy, .FFVAD, .KL4Bh, ._9AhH0, .eLAPa _23QFA",this.mouseEnterHandler),$(document).off("mouseenter","._si7dy, .FFVAD, .KL4Bh, ._9AhH0, .eLAPa _23QFA",this.mouseLeaveHandler)}mouseEnterHandler(a){const b=$(a.target).parent().find(".FFVAD"),c=b.closest("a"),d=c.find(".u7YqG");if(d.length&&d.children().hasClass("mediatypesSpriteVideo__filled__32 u-__7"))return imgOptions.isElementHovered=!0,imgOptions.isVideo=!0,imgOptions.linkToVideo=c[0].href,!0;imgOptions.isVideo=!1;imgOptions.url=b[0].src,imgOptions.isElementHovered=!0}mouseLeaveHandler(){imgOptions.url=null,imgOptions.isElementHovered=!1,imgOptions.isVideo=!1}}const c=new Content;