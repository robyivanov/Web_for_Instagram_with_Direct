class AppModal{constructor(){this.container=null,this.closeTimeout=null,this.storage,this.initStorage()}initContainer(){this.container=document.createElement("div"),this.container.id="insta_modal_container",this.container.style.display="none",this.container.classList.add(this.storage.showCase),this.container.addEventListener("mouseenter",()=>{let a=document.getElementById("insta_modal_container").children[0];a.contentWindow.focus()}),document.body.appendChild(this.container)}initStorage(){chrome.storage.local.get(this.storage,b=>{this.storage=0===Object.keys(b).length?STORAGE:b,this.initListeners(),this.initContainer()})}initListeners(){chrome.runtime.onMessage.addListener(a=>{switch(a.action){case"show_modal":this.container.classList.contains("open")?"browserAction"==a.from&&this.close():this.open(a.url);break;case"storage_update":this.container.classList.remove("left"),this.container.classList.remove("right"),this.container.classList.add(a.storage.showCase);}}),this.outsideClickListener=this.outsideClickListener.bind(this)}outsideClickListener(a){!this.container.contains(a.target)&&this.container.classList.contains("open")&&this.close()}open(a){if(clearTimeout(this.closeTimeout),this.container.style.display="block",setTimeout(()=>{this.container.classList.add("open"),this.focusFrame()},10),a){if(a.match("http://")&&(a=a.replace("http://","https://")),document.getElementById("insta_modal_container").children[0]&&a==document.getElementById("insta_modal_container").children[0].src)return;this.container.innerHTML=`        <iframe frameborder="0" onload="this.focus()" src="${a}"></iframe>      `}else{if(document.getElementById("insta_modal_container").children[0]&&"https://instagram-app.com/app/"==document.getElementById("insta_modal_container").children[0].src)return;this.container.innerHTML=`        <iframe frameborder="0" onload="this.focus()" src="https://instagram-app.com/app/"></iframe>      `}document.addEventListener("click",this.outsideClickListener)}close(){this.container.classList.remove("open"),this.closeTimeout=setTimeout(()=>{this.container.style.display="none"},530)}focusFrame(){document.getElementById("insta_modal_container").children[0].contentWindow.focus()}}const appModal=new AppModal;